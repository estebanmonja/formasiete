<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Forma Siete</title>
    <style>
        /* --- Reset & Layout --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
        }

        #stage {
            width: 500px;
            height: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Clips the image when sliding out */
            position: relative;
        }

        #tangram-img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            pointer-events: none;
            user-select: none;
            -webkit-user-drag: none;
            will-change: transform, opacity; /* Optimizes performance */
        }

        /* --- Animations --- */
        
        /* 1. Slide UP (Next) */
        .anim-slide-out-up {
            animation: slideOutUp 0.3s forwards ease-in;
        }
        .anim-slide-in-up {
            animation: slideInUp 0.3s forwards ease-out;
        }

        /* 2. Slide DOWN (Prev) */
        .anim-slide-out-down {
            animation: slideOutDown 0.3s forwards ease-in;
        }
        .anim-slide-in-down {
            animation: slideInDown 0.3s forwards ease-out;
        }

        /* Keyframes */
        @keyframes slideOutUp {
            to { transform: translateY(-100%); opacity: 0; }
        }
        @keyframes slideInUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideOutDown {
            to { transform: translateY(100%); opacity: 0; }
        }
        @keyframes slideInDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

    </style>
</head>
<body>

    <div id="stage">
        <img id="tangram-img" src="imgs/0000.png" alt="Forma Siete">
    </div>

    <script>
        // --- Configuration ---
        const maxSequence = 21; // Images 000 to 021
        
        // --- State ---
        let currentIndex = 0;
        let isColored = 0; // 0 or 1
        let isAnimating = false; // Prevents spamming swipes

        const imgElement = document.getElementById('tangram-img');

        // --- Core Logic ---

        function getFilename(index, colorState) {
            const sequenceString = String(index).padStart(3, '0');
            return `imgs/${sequenceString}${colorState}.png`;
        }

        // --- Navigation with Animation ---

        function navigate(direction) {
            if (isAnimating) return;
            isAnimating = true;

            // Calculate Next Index (with Loop)
            let nextIndex;
            if (direction === 'next') {
                nextIndex = currentIndex >= maxSequence ? 0 : currentIndex + 1;
            } else {
                nextIndex = currentIndex <= 0 ? maxSequence : currentIndex - 1;
            }

            // Determine Animation Classes
            const outClass = direction === 'next' ? 'anim-slide-out-up' : 'anim-slide-out-down';
            const inClass = direction === 'next' ? 'anim-slide-in-up' : 'anim-slide-in-down';

            // Step 1: Slide Out Old Image
            imgElement.className = ''; // Reset classes
            imgElement.classList.add(outClass);

            // Wait for animation to finish (300ms matches CSS)
            setTimeout(() => {
                // Step 2: Swap Source
                currentIndex = nextIndex;
                imgElement.src = getFilename(currentIndex, isColored);

                // Step 3: Slide In New Image
                imgElement.className = ''; // Remove out class
                imgElement.classList.add(inClass);

                // Step 4: Cleanup after entry
                setTimeout(() => {
                    imgElement.className = '';
                    isAnimating = false;
                }, 300);

                // Preload adjacent for smoothness
                preloadNeighbors();

            }, 300); 
        }

        // Just toggle color (No slide animation, happens instantly)
        function toggleColor() {
            isColored = isColored === 0 ? 1 : 0;
            imgElement.src = getFilename(currentIndex, isColored);
        }

        function preloadNeighbors() {
            const next = currentIndex >= maxSequence ? 0 : currentIndex + 1;
            const prev = currentIndex <= 0 ? maxSequence : currentIndex - 1;
            new Image().src = getFilename(next, isColored);
            new Image().src = getFilename(prev, isColored);
            new Image().src = getFilename(currentIndex, isColored === 0 ? 1 : 0);
        }

        // --- Interaction Handlers ---

        // 1. CLICK / TAP to Toggle Color
        document.body.addEventListener('click', (e) => {
            // Check if user is scrolling/swiping vs tapping
            // (Simple implementation: click always toggles color)
            if(!isAnimating) toggleColor();
        });

        // 2. SWIPE (Touch) logic
        let touchStartY = 0;
        let touchEndY = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartY = e.changedTouches[0].screenY;
        }, {passive: false});

        document.addEventListener('touchend', (e) => {
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        }, {passive: false});

        function handleSwipe() {
            const sensitivity = 50; 
            const distance = touchEndY - touchStartY;

            if (Math.abs(distance) > sensitivity) {
                // If it's a swipe, cancel the click/color toggle that might fire
                // (Note: Browsers usually handle this, but logic separates navigation from toggle)
                
                if (distance < 0) {
                    // Swiped UP -> Next Image
                    navigate('next');
                } else {
                    // Swiped DOWN -> Prev Image
                    navigate('prev');
                }
            }
        }

        // 3. DESKTOP WHEEL logic
        window.addEventListener('wheel', (e) => {
            if (e.deltaY > 0) navigate('next');
            else navigate('prev');
        });

    </script>
</body>
</html>
